# é˜¶æ®µ1: æ ¸å¿ƒè¿æ¥å±‚ä¿®å¤

**ä¼˜å…ˆçº§**: ğŸ”´ P0 Critical  
**é¢„è®¡è€—æ—¶**: 7å°æ—¶  
**ç›®æ ‡**: æ‰“é€šConfigStoreåˆ°LayoutEngineçš„å“åº”å¼é“¾è·¯ï¼Œç»Ÿä¸€å°ºå¯¸ä½“ç³»ï¼Œå®ç°å®¹å™¨å®½åº¦è‡ªé€‚åº”ã€‚

---

## ä»»åŠ¡æ¸…å•

### 1.1 ç»Ÿä¸€å°ºå¯¸ä½“ç³» (2å°æ—¶)
**ç›®æ ‡**: å°†æ‰€æœ‰å°ºå¯¸æ ‡å‡†åŒ–ä¸º`CELL_SIZE=96`ï¼Œç¡®ä¿å­—æ ¼ä¸æ–‡å­—å®Œç¾å¯¹é½ã€‚

**ä¿®æ”¹æ–‡ä»¶**:

**1ï¸âƒ£ `src/utils/layoutEngine/index.ts`**
```typescript
// ä¿®æ”¹ defaultConfig
const defaultConfig: LayoutConfig = {
  fontSize: 64,        // åŸå€¼: 32 â†’ 64 (å æ ¼å­çº¦67%)
  lineHeight: 1.2,     // ä¿æŒä¸å˜
  charWidth: 96,       // åŸå€¼: 40 â†’ 96
  gridSize: 96,        // â­æ ¸å¿ƒä¿®æ”¹: 40 â†’ 96
  paddingTop: 60,      // å»ºè®®å¢åŠ åˆ° 60-80
  paddingBottom: 60,
  paddingLeft: 60,     // åŸå€¼: 40 â†’ 60
  paddingRight: 60,
  columns: 10,         // åŸå€¼: 14 â†’ 10 (æ ¼å­å˜å¤§ï¼Œåˆ—æ•°å‡å°‘)
  isVertical: false,
  // ...æ–°å¢å­—æ®µåœ¨ä»»åŠ¡1.2æ·»åŠ 
};
```

**2ï¸âƒ£ `src/components/CharacterCell.vue`**
```typescript
// ä¿®æ”¹ props é»˜è®¤å€¼
const props = withDefaults(defineProps<Props>(), {
  width: 96,     // ä¿æŒ 96
  height: 96,    // ä¿æŒ 96
  fontSize: 64,  // â­ ä¿®æ”¹: 60 â†’ 64
  // ...
});
```

**3ï¸âƒ£ `src/utils/layoutEngine/strategies/gridStrategy.ts`**
- ç¡®ä¿æ‰€æœ‰åæ ‡è®¡ç®—ä½¿ç”¨ `config.gridSize` è€Œä¸æ˜¯ç¡¬ç¼–ç å€¼ã€‚
- æ£€æŸ¥ç‚¹ï¼šæœç´¢ä»£ç ä¸­çš„ `40` å¹¶æ›¿æ¢ä¸ºå˜é‡å¼•ç”¨ã€‚

---

### 1.2 å®ç°ConfigStoreâ†’LayoutEngineåŒæ­¥ (3å°æ—¶)
**ç›®æ ‡**: æ‰“é€šè®¾ç½®é¢æ¿åˆ°å¸ƒå±€å¼•æ“çš„åŒå‘å“åº”å¼é“¾è·¯ã€‚

**ä¿®æ”¹æ–‡ä»¶**:

**1ï¸âƒ£ `src/utils/layoutEngine/types.ts`**
```typescript
export interface LayoutConfig {
  // ...åŸæœ‰å­—æ®µ
  
  // === æ–°å¢å­—æ®µ ===
  layoutDirection: 'vertical' | 'horizontal';
  verticalColumnOrder?: 'rtl' | 'ltr';
  borderMode: 'full' | 'lines-only' | 'none';
  gridType: string;
  gap: number;
  fixedGrid?: {
    enabled: boolean;
    rows?: number;
    cols?: number;
  };
}
```

**2ï¸âƒ£ `src/components/PaperCanvas.vue`**
å®ç°ç¬¬17-41è¡Œçš„ `watchEffect`ï¼š
```typescript
import { useConfigStore } from '@/stores/config';
import { storeToRefs } from 'pinia';

const configStore = useConfigStore();
const { layoutDirection, verticalColumnOrder, borderMode, gridType, fixedGrid } = storeToRefs(configStore);

watchEffect(() => {
  const gap = borderMode.value === 'none' ? 0 : 3;

  layoutConfig.value = {
    // åŸºç¡€é…ç½®
    fontSize: 64,
    lineHeight: 1.2,
    charWidth: 96,
    gridSize: 96,
    paddingTop: 60,
    paddingBottom: 60,
    paddingLeft: 60,
    paddingRight: 60,
    
    // åŠ¨æ€åˆ—æ•° (åœ¨ä»»åŠ¡1.3å®ç°)
    columns: 10, 
    
    // å“åº”å¼æ˜ å°„
    isVertical: layoutDirection.value === 'vertical',
    layoutDirection: layoutDirection.value,
    verticalColumnOrder: verticalColumnOrder.value,
    borderMode: borderMode.value,
    gridType: gridType.value,
    gap: gap,
    fixedGrid: { ...fixedGrid.value },
  };
});
```

---

### 1.3 å®ç°å®¹å™¨å®½åº¦å“åº”å¼ (2å°æ—¶)
**ç›®æ ‡**: è§£å†³å°çª—å£é®æŒ¡é—®é¢˜ï¼Œæ ¹æ®å®½åº¦è‡ªåŠ¨è®¡ç®—åˆ—æ•°ã€‚

**ä¿®æ”¹æ–‡ä»¶**:

**1ï¸âƒ£ `src/components/PaperCanvas.vue`**
å¼•å…¥ VueUse å¹¶å®ç°åŠ¨æ€è®¡ç®—ï¼š
```typescript
import { useElementSize } from '@vueuse/core';

const containerRef = ref<HTMLElement>();
const { width: containerWidth, height: containerHeight } = useElementSize(containerRef);

const dynamicColumns = computed(() => {
  // ä¼˜å…ˆå¤„ç†å›ºå®šåˆ—æ•°
  if (configStore.fixedGrid.enabled) {
    if (layoutDirection.value === 'horizontal' && configStore.fixedGrid.cols) {
      return configStore.fixedGrid.cols;
    }
    // ...
  }
  
  // è‡ªé€‚åº”è®¡ç®—
  if (!containerWidth.value) return 10;
  
  const gridSize = 96;
  const padding = 60;
  const gap = borderMode.value === 'none' ? 0 : 3;
  
  const availableWidth = containerWidth.value - padding * 2;
  return Math.max(1, Math.floor(availableWidth / (gridSize + gap)));
});

// åœ¨ watchEffect ä¸­ä½¿ç”¨
// columns: dynamicColumns.value
```

---

## âœ… éªŒè¯æ ‡å‡†

1.  **å°ºå¯¸æ£€æŸ¥**: CharacterCell æ¸²æŸ“ä¸º 96x96pxï¼Œæ–‡å­—å±…ä¸­ã€‚
2.  **è®¾ç½®å“åº”**: åˆ‡æ¢è®¾ç½®é¢æ¿çš„â€œè¾¹æ¡†æ¨¡å¼â€ï¼Œæ— éœ€åˆ·æ–°é¡µé¢ï¼Œç”»å¸ƒç«‹å³å˜åŒ–ã€‚
3.  **çª—å£é€‚é…**: æ‹–åŠ¨æ”¹å˜çª—å£å®½åº¦ï¼Œåˆ—æ•°è‡ªåŠ¨å¢å‡ï¼Œæ— æ¨ªå‘æ»šåŠ¨æ¡ã€‚
