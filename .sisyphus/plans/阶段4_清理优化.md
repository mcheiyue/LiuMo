# 阶段4: 清理优化

**优先级**: 🟢 P3 Low  
**预计耗时**: 1.5小时  
**目标**: 移除不再需要的旧功能（智能吸附），确保新功能的健壮性。

---

## 任务清单

### 4.1 移除智能吸附 (30分钟)
**目标**: 删除 V1.5.5 时代的遗留功能，因为 V8.0 的 LayoutEngine 已通过策略模式（grid/flow）自动处理了类似需求。

**修改文件**:

**1️⃣ `src/stores/config.ts`**
- 删除 `smartSnap` 状态字段及其 action。

**2️⃣ `src/components/SettingsPanel.vue`**
- 删除相关的 UI 开关组件（约 72-80 行）。

**3️⃣ `src/utils/layoutEngine`**
- 确保没有策略引用 `smartSnap` 变量。

---

### 4.2 fixedGrid 功能验证 (1小时)
**目标**: 确保“固定行列”功能在重构后的自适应系统中优先级正确。

**修改文件**:

**1️⃣ `src/components/PaperCanvas.vue`**
检查动态计算逻辑的优先级：

```typescript
const dynamicColumns = computed(() => {
  // ⛔️ 必须优先检查固定配置
  if (configStore.fixedGrid.enabled) {
    // 横排固定列
    if (layoutDirection.value === 'horizontal' && configStore.fixedGrid.cols) {
      return configStore.fixedGrid.cols;
    }
    // 竖排固定列（即排版后的行宽，但在 gridStrategy 中通常由高度决定行数，由宽度决定列数）
    // 这里需明确：竖排的 columns 指的是"有多少列文字"（x轴方向）
    // 如果用户想固定"一页显示多少行字"，其实是设置 columns
  }
  
  // ... 后续才是自适应逻辑
});
```

**验证场景**:
1.  开启“固定行列”，设置为 8 行 8 列。
2.  无论窗口如何缩放，画布始终显示 8x8 的网格。
3.  关闭“固定行列”，画布立即恢复自适应。

---

## ✅ 验证标准

1.  **代码整洁**: 搜索 `smartSnap` 无结果。
2.  **功能互斥**: 开启“固定行列”时，窗口缩放不影响布局；关闭后恢复响应式。
3.  **无死代码**: 检查是否有未使用的 CSS 变量或 computed 属性。
