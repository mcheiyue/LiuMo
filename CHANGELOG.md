# 更新日志 (Changelog)

## v1.4.5 - PDF 导出重构与体积优化 (2026-01-27)

### 🐛 修复与改进 (Fixes & Improvements)

- **PDF 导出重构**:
  - **修复“黑框”问题**: 彻底解决了导出 PDF 时，红色的网格线变成黑色粗框的问题。原因确认是 PDF 渲染引擎无法正确处理半透明颜色，现已替换为视觉一致的不透明实色 (#D58B85)。
  - **所见即所得 (WYSIWYG)**: 修复了“仅显示边框”模式下，米字格仍然被强制导出的 Bug。现在导出效果与软件预览完全一致。
  - **体积大幅优化**: 将导出采样率从 2.0 调整为 1.5。在肉眼几乎无法察觉清晰度差异的情况下，将 PDF 文件体积减小了 **40%~50%**（解决了 50MB 异常大的问题）。

- **版本号修正**:
  - 修复了安装包版本号滞后的问题。`package.json` 和 `tauri.conf.json` 现已同步为 **1.4.5**，安装后将正确显示新版本。

## v1.4.3 - 完美打印修正版 (2026-01-26)

- **修复“方框”残留 (Fix Ghost Boxes)**: 在“仅分割线 (Lines Only)”模式下，彻底消除了导出 PDF 时每个字符周围出现的黑色方框。现在只会显示您期望的行列分割线。
- **解决文字阻挡 (Fix Content Cutoff)**:
  - 增加了 PDF 安全边距 (Margin) 至 40pt (约 1.4cm)，防止打印机裁切内容。
  - 优化了分页切割算法，采用更保守的策略，确保每一列文字都完整呈现，不会在页边缘被“吃掉”一部分。

## v1.4.2 - 核心修复：分页与性能 (2026-01-26)

- **完美分页 (Pixel-Perfect Slicing)**: 重写了分页算法，不再暴力按像素切分，而是基于**字格维度 (Grid Rows/Cols)** 进行精确切割，彻底杜绝了“字被腰斩”的现象。
- **性能优化 (Performance)**: 解决了使用大型中文字体导出时出现的 `Maximum call stack size exceeded` 崩溃问题。通过使用 `Blob URL` 替代 Base64 注入，大幅降低了内存占用。
- **视觉修正**: 修复了“仅分割线 (Lines Only)”模式下，导出 PDF 仍残留黑色格线的渲染 Bug。

## v1.4.1 - 视觉修复 (2026-01-26)

- **修复导出样式丢失**: 彻底解决了导出 PDF 时出现的“黑框”、“背景透明”等样式丢失问题。
- **优化颜色保真度**: 强制使用内联样式，确保导出的 PDF 与屏幕显示完全一致（红框、米色底、黑墨）。

## v1.4.0 - 完美的打印与导出体验 (2026-01-26)

本次更新彻底重构了 PDF 导出模块，解决了长篇内容打印难的问题，并实现了所见即所得的精准导出。

### 🖨️ 导出与打印 (PDF Export)
- **智能分页 (Smart Pagination)**:
  - 告别“缩印”：长篇内容不再被暴力压缩到一页，而是根据字格大小自动切分为多页 PDF。
  - **竖排模式**: 自动从右向左切分，符合传统阅读习惯。
  - **横排模式**: 自动从上向下切分。
  - 完美衔接：利用虚拟视窗技术，确保切分处字格完整，无缝拼接。
- **自定义字体嵌入 (Font Embedding)**:
  - 彻底解决了导出 PDF 时书法字体丢失（变回宋体）的问题。
  - 即使使用外部加载的字体文件，也能在 PDF 中完美呈现。
- **方向自适应**:
  - 自动根据内容的长宽比例选择 A4 纸张方向（横向/纵向），最大化利用纸张空间。
- **RTL 修正**: 
  - 修复了竖排模式下，导出 PDF 时列顺序可能反转（变成从左到右）的严重排版错误。

---

## v1.3.2 - 体验革新：智能排版与布局重构 (2026-01-26)

### ✨ 新增功能 (Features)
- **智能格线吸附 (Smart Snap)**: 
  - 自动识别诗词体裁（如五言、七言），智能调整网格行列数，呈现如古籍般的完美对齐效果。
  - 告别生硬的换行，让诗词阅读更具韵律感。
- **排版自由度升级**:
  - **手动行列控制**: 支持自定义“每行/列字数”，满足特殊创作或排版需求。
  - **竖排阅读顺序**: 新增“从右向左（传统）”与“从左向右（现代）”切换功能，兼顾传统与现代阅读习惯。
  - **横排模式增强**: 提供完整的横排书写体验，支持垂直滚动阅读。

### ⚡ 优化与改进 (Improvements)
- **布局引擎重构**: 
  - 全面弃用 Flex 布局，改用 **JavaScript 精确计算 + CSS Grid** 方案。
  - 彻底消除了网格边缘的红色缝隙，视觉效果更加干净整洁。
- **滚动体验优化**: 
  - 修复竖排模式下 (RTL) 左侧内容无法滚动访问的问题。
  - 优化拖拽窗口时的网格自适应算法，响应更灵敏流畅。
- **发布产物规范**: 统一了安装包、MSI 和便携版的文件命名格式 (LiuMo_v1.3.2_x64_portable.exe)。

### 🐛 问题修复 (Fixes)
- 修复了旧版本配置迁移时可能导致的应用无响应/白屏问题（增加配置自动修复机制）。
- 修复了横排模式下可能只显示单列的布局错误。
- 修复了空余网格透出底层红色背景的问题。

---

## v1.3.1 - 品牌重塑与体验优化 (2026-01-26)

本次更新主要集中在品牌形象升级与 Windows 平台体验优化，同时巩固了 v1.3.0 带来的海量数据支持。

### 🎨 品牌与视觉 (UI/UX)
- **应用更名**：正式由 "liumo" 更名为中文品牌 **“流摹”**。
- **全新图标**：
  - 采用极简草书“流”字设计，寓意“笔尖流淌，心摹手追”。
  - 针对 Windows 平台优化了图标裁切，采用 **透明圆角 (Squircle)** 设计，完美适配 Windows 11/10 任务栏与开始菜单。
  - 修复了开发与生产环境下任务栏图标可能显示异常的问题。

### 🛠️ 修复与优化 (Fixes)
- **任务栏图标**：在 Rust 后端增加了强制图标加载逻辑，解决了 Windows 系统下应用图标偶发性丢失的问题。
- **元数据更新**：同步更新了 `Cargo.toml` 与 `package.json` 中的项目描述与版本号。

---

## v1.3.0 - 数据内核重构 (2026-01-25)

### 📚 数据工程 (Data Engineering)
- **海量题库**：集成了 **420,000+** 条诗词数据，涵盖：
  - 唐诗、宋词、元曲
  - **新增**：古文/文言文（如《岳阳楼记》、《滕王阁序》）
  - **新增**：现代诗（如海子、徐志摩作品）
- **性能优化**：
  - 引入 `Resources Bundle` 架构，通过 Gzip 压缩将数据库体积控制在 80MB 以内。
  - 实现“首次启动自动解压”机制，确保用户开箱即用。
  - 后端查询优化：实现分页 (`LIMIT/OFFSET`) 与连接池，彻底解决大数据量下的内存崩溃问题。

### 🖥️ 功能增强 (Features)
- **无限滚动**：重构搜索界面，支持数千条结果的流畅滑动加载。
- **分类筛选**：新增“古文”与“现代诗”专属分类标签。
